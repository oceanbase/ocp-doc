# 创建集群

您可以根据业务需要新建待管理的集群。

## 前提条件

* 当前登录 OCP 的用户有 **Create Cluster** 的权限。

* （可选）如您创建的是多副本 OceanBase 集群，则需当前 OCP 中已存在可用的 OBProxy 集群，您可参考如下链接新增 OBProxy 集群。

  * [创建 OBProxy 集群](../../8.obproxy/1.create-an-obproxy-cluster-2.md)

  * [接管 OBProxy](../../8.obproxy/2.obproxy-3.md)

## 操作步骤

1. 登录 OCP 后，根据实际业务场景，找到新建集群的入口。

   1. 如果您没有可管理的集群，系统会在 **集群** 页面提示您新建集群，直接在提示信息中单击 **创建集群** 。

   2. 如果您已经有可管理的集群，则在 **集群** 页面右上角，单击 **新建集群** 。

2. 在 **新建集群** 页面，设置集群的基础信息。

   * 创建主集群

      ![Image 175](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E5%88%9B%E5%BB%BA%E4%B8%BB%E9%9B%86%E7%BE%A4.png)
  
      基础信息填写说明如下表所示。

     |        配置         |                                                                                                                                                                                            描述                                                                                                                                                                                            |
     |-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
     | **集群类型**          | 选择 **主集群** 。                                                                                                                                                                                                                                                                                                                                                                             |
     | **集群名称**          | 自定义待管理的集群的名称。集群名称必须以英文字母开头，可支持大小写字母、数字和下划线，长度为 2\~48 字符。                                                                                                                                                                                                                                                                                                                                 |
     | **root@sys 密码**    | 支持自定义或随机生成。 密码需要满足以下复杂度条件：<ul><li>长度为 8\~32 个字符</li><li>支持字母、数字和特殊字符，且至少包含大、小写字母、数字和特殊字符各 2 个</li><li>支持的特殊字符为 \~!@#%\^\&\*_-+=\`\|(){}\[\]:;',.?/  </li></ul>                                                                                                                                                                                                                                             |
     | **OB 版本**         | 可以从列表中选择已有的 OceanBase 集群版本，也可以在列表下方单击 **添加版本** ，上传一个 OceanBase 的版本。                                                                                                                                                                                                                                                                                                                        |
     | **关联 OBProxy 集群** | 如您创建的是多副本的 OceanBase 集群，建议您打开关联 OBProxy 集群开关，为该 OceanBase 集群关联 OBProxy 集群。 关联后您的业务涉及的 SQL 请求将会被精准转发到相应的副本，使您对 OceanBase 数据库的访问效果能够媲美访问单机数据库。 </br>1. 默认使用 proxyro 用户关联，您无需填写用户名和密码。 </br>  2. 在下拉框中选择要关联的 OBProxy 集群。如下拉框中没有可关联的 OBProxy 集群，请参考本文 **前提条件** 中的描述添加 OBProxy 集群。<blockquote>**注意**</br>当 **OB 版本** 中选择的集群为 V4.0 及以上版本时，仅支持关联 V4.0.0 及以上版本的 OBProxy 集群。</blockquote>    |

   * 创建备集群
  
      ![Image 176](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E5%88%9B%E5%BB%BA%E5%A4%87%E9%9B%86%E7%BE%A4.png)

      基础信息填写说明如下标所示：

     |       配置       |                                                                                         描述                                                                                          |
     |----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
     | **集群类型**       | 选择 **备集群** ，请确保主集群已创建。                                                                                                                                                              |
     | **集群名**        | OCP 单集群模式下需配置。 自定义待管理的集群的名称。集群名称必须以英文字母开头，可支持大小写字母、数字和下划线，长度为 2\~48 字符。                                                                                             |
     | **主集群所属 OCP**  | OCP 多集群模式下需配置。 多集群模式请参见 [多集群模式概述](../../3.features/9.system-management-features-1/8.overview-of-multi-cluster-mode.md)。                                                                                     |
     | **主集群**        | 选择主集群，系统将创建属于该主集群的备集群。                                                                                                                                                              |
     | **root@sys 密码** | OCP 多集群模式下需配置。 填写主集群的 root@sys 密码。任务提交后，系统会在密码箱中存储该密码。                                                                                                              |
     | **备集群 OB 版本**  | 选择与主集群一样的 OceanBase 版本。 <ul><li> 若列表中有该版本，则从列表中直接选择。   </li><li> 否则，可通过单击列表下方的 **添加版本** 来上传。</li> </ul>   |

3. 设置集群的部署模式信息。

   默认添加 3 个 Zone 的信息，如果您希望部署的集群 Zone 的个数大于 3 个，您可以在下方单击 **新增** 按钮，增加 Zone 信息。如果部署的集群 Zone 的个数小于 3 个，您可以单击 Zone 后面的删除图标。

   ![10](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F.png)

   每个 Zone 需要设置的信息及其说明如下表所示。

   |                             配置                              |                                                                                                                                                                                                                                                       描述                                                                                                                                                                                                                                                       |
   |-------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | **Zone 名称**                                                 | 可保持默认也可自定义。 Zone 名称必须以英文字母开头，支持大小写字母、数字和下划线，长度为 2\~48。 部署多 Zone 的 OceanBase 集群必须有一个 Zone 与主 Zone 的 Region 相同。                                                                                                                                                                                                                                                                                                                                                                  |
   | **机房**                                                      | Zone 所在的机房，一个 Zone 只能存在于一个机房。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | **机型**                                                      | 可选项。 如果选择了机型，后面主机列表会根据机型进行过滤。                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | **机器选择方式**                                                  | 可选择 **自动分配** 或者 **手动选择** 。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   | **IP**                                                      | 您可以选择多个 IP。<ul><li> 如果 **机器选择方式** 是 **自动分配** ，则只需要输入机器的数量，OCP 会自动选择相应数量的可用机器；  </li><li>如果 **机器选择方式** 是 **手动选择** ，则需要您手动从列表中选择若干个 IP。</li>  </ul>                                                                                                                                                                                                                                                                                 |
   | **Root Server 位置**                                          | 您需选择一个 IP 作为 RootService 所在的机器。多副本的 OceanBase 集群，其每个 Zone 都需指定一个 root Server。                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   | **优先级排序**  **（创建备集群无需配置）**  | Zone 的优先级排序。最高优先级的 Zone 会被视为 Primary Zone，且只能有一个。 排序方法：</br> 1. 勾选左侧列表框中的一个或多个 Zone。 左侧列表框中显示了当前集群中所有可选的 Zone。</br>   2. 单击中间的 \> 按钮。 此时勾选的 Zone 就会被移动到 **优先级排序** 列表中。同时勾选的多个 Zone 具有相同的优先级。 </br>  3. 重复 a、b 动作，添加低一优先级的 Zone。</br>   4. 如需调整优先级，可在 **优先级排序** 列表中拖拽以调整顺序。 列表中从上到下，优先级依次递减。    |

4. 打开 **参数设置** ，对参数进行修改。

   ![09161737](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE.png)

5. 配置 **安装路径设置** 。

   ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84.png)

   根据需要自定义 **软件安装路径、数据盘路径** 和 **日志路径** 。

6. 单击 **测试** 。

7. 测试成功后，单击 **提交** 。

8. 在弹出的 **确认提交信息** 对话框中，确认信息无误后，单击 **确定** 。

   您可在 **系统管理 \> 任务** 中查看该任务的执行进度。
