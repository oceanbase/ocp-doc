# 管理活跃会话历史报告

本节为您介绍生成和查看活跃会话历史报告的方法。通过该报告，您能够了解历史诊断时间内占用数据库资源较高的 SQL，以及 OceanBase 集群历史会话的执行详情等信息。您可根据这些信息优化 SQL 从而提高 SQL 的执行效率。

<main id="notice" type='notice'>
  <h4>功能适用性</h4>
  <p>OCP V4.2.1 社区版暂不支持活跃会话历史报告。</p>
</main>

您可通过以下两个入口查看及管理活跃会话历史报告：

* **入口一：**

    登录 OCP，进入租户 **概览** 页面。在左侧单击 **会话管理** ，并进入 **活跃会话历史报告** 页签。

* **入口二：**

    登录 OCP，进入集群 **实时诊断** 页面。在左侧单击 **报告中心**，并进入 **活跃会话报告** 页签。

## 前提条件

当前登录的用户具有租户管理的权限。

## 操作步骤

以下步骤以 **入口二** 为例。

1. 登录 OCP。

2. 在左侧导航栏中，单击 **自治服务**。

3. 在 **集群详情** 区域，单击需要查看的集群名称，系统默认进入 **实时诊断** 页面。

4. 单击左侧导航栏 **报告中心**。

5. 进入 **活跃会话报告** 页签下。

6. 单击 **生成活跃会话报告** 。

   系统弹出 **生成活跃会话历史报告** 的对话框。

7. 填写 **分析时间** 和 **报告名** 。

   * 分析时间：活跃会话的分析起止时间。

   * 报告名：填写分析时间后，系统根据分析起止时间自动生成报告名，生成规则为 "OBASH_集群名_租户名_起始时间_结束时间"。用户也可自定义报告名。

   ![09134113](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4384151361/p326154.png)

8. 单击 **确定** 。

   系统开始生成活跃会话历史报告，请等待任务执行完成。

9. 在 **报告列表** 的查询框中输入报告名或创建人并单击搜索图标，搜索您要查看的报告。**报告列表** 中将返回符合条件的报告。

   * 单击操作列的 **查看** ，可直接查看报告。

   * 单击操作列的 **下载** ，可下载报告后查看。

## 报告内容简介

在活跃会话历史报告中您能够查看到如下信息。

* 基本信息

  |    参数     |                                               说明                                               |
  |-----------|------------------------------------------------------------------------------------------------|
  | 报告的基本信息   | 可查看该报告分析数据的起始时间、结束时间、经过时间、采样点数、平均活跃会话数。                                                        |
  | 租户的基本信息   | 可查看该报告分析的目标租户的基本信息，包括租户名称、所属集群、OceanBase 版本号、租户模式、副本数、租户创建时间、部署分布以及 Zone 优先级。                         |
  | 租户资源的基本信息 | 可查看该报告分析的目标租户的资源信息，包括 Zone、OBServer、Unit 资源配置、副本类型、Active MemStore 大小限制（GB）、MemStore 大小限制（GB）。 |

* Top 等待事件

  展示事件时间占比 Top5 的等待事件。
  
* TopSQL 的命令类型

  展示 TopSQL 的 SQL 命令类型、唯一 SQL ID 数、响应时间占比（%）和平均活跃会话数。
  
* SQL 统计信息

  * 按照等待时间排序的 SQL：展示等待时间占比 Top5 的 SQL。

  * 完整的 SQL 文本列表：展示等待时间占比 Top5 的 SQL 的完整 SQL文本 。

* 按照等待事件排序的会话

  展示等待事件活跃率 Top5 的会话，同时展示这些会话中事件时间占比 Top3 的等待事件。
  
* 活动切片时间

  展示分析时间段内所有切片时间的起止时间、持续时间，以及切片时间内的平均活跃会话数、等待事件 Top3、等待事件活跃率、等待事件时间占比。
  