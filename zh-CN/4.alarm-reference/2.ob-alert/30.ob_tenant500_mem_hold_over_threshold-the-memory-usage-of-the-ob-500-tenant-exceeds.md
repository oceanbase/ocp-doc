ob_tenant500_mem_hold_over_threshold
OB 500 租户的占用内存大小超限
=============================================================================



**告警描述**
-----------------------------

OB 500 租户（特殊统计，不特指某一个租户）占用内存大小超限时，触发该告警。

告警原理
-------------------------

下表列出了该告警监控逻辑中涉及的关键参数。


|    参数    |                                                                                                                                               值                                                                                                                                               |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 监控指标     | ob_tenant500_mem_hold_gigabyte **说明**  表示 OceanBase 系统租户占用的内存量，当 500 租户（特殊统计，不特指某一个租户）占用内存量大于阈值（默认为 100G）时触发告警。                                                                                                                                               |
| 指标来源     | ```unknow grep 'tenant: 500' /home/admin/log/observer.log | awk -F 'hold:' '{{print $2}}' | awk 'END{{print $1}} ```  **说明**  该告警的指标来源与其他表达式触发的告警不同，是通过 OCP-Agent 每个 **采集周期** 执行上述命令搜索 OBServer 目录下含 hold 关键字的日志，从而获取 **采集指标** tenant500_mem_hold 的值。 |
| 采集指标（GB） | tenant500_mem_hold                                                                                                                                                                                                                                                                            |
| 监控表达式    | sum(tenant500_mem_hold{@LABELS}) by (@GBLABELS)                                                                                                                                                                                                                                               |
| 采集周期     | 60 秒                                                                                                                                                                                                                                                                                          |



**规则信息**
-----------------------------



|              监控指标              | 默认阈值（单位：GB） | 持续时间 | 检测周期 | 消除周期 |
|--------------------------------|-------------|------|------|------|
| ob_tenant500_mem_hold_gigabyte | 100         | 0 秒  | 60 秒 | 5 分钟 |



**告警信息**
-----------------------------



|   告警触发方式   | 告警等级 | 范围  |
|------------|------|-----|
| 基于监控指标的表达式 | 严重   | 服务器 |



**告警模板**
-----------------------------

* 告警概述模板：${alarm_target} ${alarm_name}



* 告警详情模板：${alarm_target} ${alarm_name} 占用内存 ${value} GB， 超过 ${alarm_threshold}



* 告警概述样例：ob_cluster=C1-1000:svr_ip=192.168.1.1 OB 500 租户的占用内存大小超限



* 告警详情样例：ob_cluster=C1-1000:svr_ip=192.168.1.1 OB 500 租户的占用内存大小超限，占用内存 101.0 GB， 超过 100.0






**对系统的影响**
-------------------------------

500 租户内存使用过多会导致机器内存资源耗尽，OBServer 内的租户会因为内存不足而无法正常工作。

**可能原因**
-----------------------------

部分已知缺陷会在特定场景下导致 500 租户内存使用持续增长。

处理方法
-------------------------

在 OCP 中进入该 OceanBase 集群 sys 租户的 **资源管理** 界面，查看 **资源使用趋势** 中的 **内存** 折线图，判断内存使用量是否符合预期。

![08181417](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2096829261/p306445.png)

* 如果内存用量符合预期，可以调整告警项阈值以避免告警持续触发。

  可在 **系统管理 \> 告警** 的 **告警项配置** 页签中找到相应告警，并通过 **编辑** 按钮修改告警阈值。


* 如果内存用量不符合预期，则需要重启 observer 进程，以避免 OBServer 因内存不够而无法工作。

  可在该 OceanBase 集群 **总览** 页的 **OBServer 列表** 中单击 **重启** 按钮，来重启 observer 进程。
