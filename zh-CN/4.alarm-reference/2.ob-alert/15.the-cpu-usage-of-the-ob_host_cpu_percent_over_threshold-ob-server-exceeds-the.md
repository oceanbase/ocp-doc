ob_host_cpu_percent_over_threshold OB 服务器 CPU 使用率超限
========================================================================



**告警描述**
-----------------------------

OBServer 的 CPU 使用率超过阈值则会触发该告警。

告警原理
-------------------------

下表列出了该告警监控逻辑中涉及的关键参数。


|  参数   |                                                                                                                                                                                                                                                                                                                                                               值                                                                                                                                                                                                                                                                                                                                                                |
|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 监控指标  | ob_host_cpu_percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 数据来源  | 由 node_exporter 进程采集                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 采集指标  | node_cpu_seconds_total                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 监控表达式 | 100 \* (1 - sum(rate(node_cpu_seconds_total{mode="idle", @LABELS}\[@INTERVAL\]) by (@GBLABELS)) by (@GBLABELS) / sum(rate(node_cpu_seconds_total{@LABELS}\[@INTERVAL\]) by (@GBLABELS)) by (@GBLABELS)) <br>**说明：**  监控表达式中通过 LABELS 来区分不同数据，包含如下 LABELS：  user ；idle ；system ；iowait ； irq ；nice ；softirq ；steal 。<br>   其中，idel 表示 CPU 处于空闲状态时间，其它状态的时间之和可以认为是CPU 的使用时间。 |
| 采集周期  | 1 秒                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |



**监控指标** ob_host_cpu_percent 的值表示 OBServer 服务器的 CPU 使用率，当使用率大于阈值（默认为 100%）时触发告警。

**规则信息**
-----------------------------



|        监控指标         | 默认阈值（单位：%） | 持续时间 | 检测周期 | 消除周期 |
|---------------------|------------|------|------|------|
| ob_host_cpu_percent | 100        | 60 秒 | 60 秒 | 5 分钟 |



**告警信息**
-----------------------------



|   告警触发方式   | 告警等级 | 范围  |
|------------|------|-----|
| 基于监控指标的表达式 | 严重   | 服务器 |



**告警模板**
-----------------------------

* 告警概述模板：${alarm_target} ${alarm_name}



* 告警详情模板：${alarm_target} ${alarm_name} CPU 使用率 ${value} 超过 ${alarm_threshold}



* 告警概述样例：ob_cluster=C1-1000:svr_ip=xxx.xxx.xxx.xxx OB 服务器 CPU 使用率超限



* 告警详情样例：ob_cluster=C1-1000:svr_ip=xxx.xxx.xxx.xxx OB 服务器 CPU 使用率超限 CPU 使用率 101.0 超过 100.0






**对系统的影响**
-------------------------------

CPU 使用率瞬时过高对系统影响较小，但 CPU 使用率持续过高会导致系统吞吐率下降，请求延迟变高。

**可能原因**
-----------------------------

常见于以下场景：

* OBServer 执行复杂 SQL 。



* 主机上运行的其它程序占用 CPU 过高。






处理方法
-------------------------

1. 确认是否是 observer 进程占用过高导致。

   在告警 OBServer 上执行 `top` 命令，查看占用 CPU 资源过高的进程。
   * 是 observer 进程，则可能会同时上报如下告警

     * [ob_cpu_percent_over_threshold OB 内统计的 CPU 使用率超限](../2.ob-alert/13.the-cpu-usage-of-the-ob_cpu_percent_over_threshold-observer-process-exceeds-the.md)



     * [tenant_cpu_percent_over_threshold OB 租户 CPU 使用率超限](../2.ob-alert/35.the-cpu-usage-of-a-tenant_cpu_percent_over_threshold-ob-tenant-exceeds-the.md)

       若 OBServer 执行复杂 SQL 可能到导致 observer 进程占用 CPU 过高，会同时触发该告警和本节所述告警。





     可先参考文档解决上述告警，然后再观察本节所述告警是否继续上报。
     * 上报，可能是其他原因，继续执行下一步。



     * 不上报，则问题解决。






   * 其他进程，则执行下一步。






2. 可能是其他进程 CPU 占用过高。

   联系 DBA 或运维人员，若有业务不依赖的进程，可将其关闭。




