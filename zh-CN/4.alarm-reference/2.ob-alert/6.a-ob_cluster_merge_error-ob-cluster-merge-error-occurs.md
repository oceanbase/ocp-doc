ob_cluster_merge_error OB 集群合并出错 
=====================================================



**告警描述** 
-----------------------------

该告警监测 OCP 管理每个 OceanBase 集群合并是否正常，若有合并出错则上报告警。

告警原理 
-------------------------

下表列出了该告警监控逻辑中涉及的关键参数。


|  参数   |                                                                值                                                                |
|-------|---------------------------------------------------------------------------------------------------------------------------------|
| 监控指标  | ob_cluster_merge_error_flag                                                                                                     |
| 指标来源  | SQL:  ```javascript select zone, name, value, time_to_usec(now()) from __all_zone; ```  |
| 采集指标  | zone_value                                                                                                                      |
| 监控表达式 | max(zone_value{metric_group="all_zone",name="is_merge_error",@LABELS}) by (@GBLABELS)                                           |
| 采集周期  | 1 秒                                                                                                                             |



无论是自动发起还是人工发起的合并，失败后会设置标志位并将合并状态更新到 __all_zone 表中。其中采集指标值取自 __all_zone 表的 value 字段值，其他字段值作为 LABELS。

**监控指标** 的值表示集群合并是否出错。当值为 0 时，表示该集群合并正常。 当值为 1 时，表示集群合并出错。

当监控指标值为 1 时触发告警。

**规则信息** 
-----------------------------



|            监控指标             | 默认阈值 | 持续时间 | 检测周期 | 消除周期 |
|-----------------------------|------|------|------|------|
| ob_cluster_merge_error_flag | 1    | 0 秒  | 60 秒 | 5 分钟 |



**告警信息** 
-----------------------------



|           告警触发方式           | 告警等级 | 范围 |
|----------------------------|------|----|
| 基于监控指标的表达式 | 严重   | 集群 |



**告警模板** 
-----------------------------

* 告警概述模板：${alarm_target} ${alarm_name}

  

* 告警详情模板：${alarm_target} ${alarm_name}

  

* 告警概述样例：ob_cluster=C1-1000 OB 集群合并出错

  

* 告警详情样例：ob_cluster=C1-1000 OB 集群合并出错

  




**对系统的影响** 
-------------------------------

* 该 OceanBase 集群部分副本数据不一致，如副本之间不一致或主表与索引表之间不一致。

  

* 主备 OBServer 集群不允许进行主备切换，否则故障将传递给关系集群。

  




**可能原因** 
-----------------------------

理论上存在的极端场景，无常见原因。

**处理方法** 
-----------------------------

请参考 [OceanBase 集群合并异常处理](../4.alarm-appendix/3.handle-oceanbase-cluster-merge-exceptions.md) 排查具体问题。

处理不当可能会导致数据不一致，如非专业人员，请联系技术支持解决。
