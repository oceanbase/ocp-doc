# host_disk_readonly 服务器磁盘只读

## 告警描述

该告警监测根目录 `/` 的挂载盘是否只读，若该挂载盘只读则触发该告警。

## 告警原理

下表列出了该告警监控逻辑中涉及的关键参数。

| **参数** | **值** |
| --- | --- |
| 监控指标 | `disk_readonly_flag`：监控指标 disk_readonly_flag 的值表示磁盘挂载点是否只读，1 表示只读，0 表示非只读（可写）。为 1 时，触发告警。 |
| 指标来源 | 采集自 node_exporter。检查主机挂载点只读的挂载点列表记录在 host.check.readonly.mountpoint，默认只检查 `/` 挂载点。增加 check_readonly="1" 的标记。 |
| 采集指标 | node_filesystem_readonly |
| 监控表达式 | max(node_filesystem_readonly{@LABELS}) by (@GBLABELS) |
| 采集周期 | 1 秒 |

## 规则信息

| **监控指标** | **默认阈值** | **持续时间** | **告警周期** | **消除周期** |
| --- | --- | --- | --- | --- |
| ob_host_disk_readonly_flag | 1 | 0 秒 | 60 秒  | 5 分钟 |

## 告警信息

| **告警触发方式** | **告警等级** | **范围** |
| --- | --- | --- |
| 基于监控指标的表达式 | 严重 | 服务器 |

## 告警模板

* 告警概述
  * 模板：\${alarm_target} ${alarm_name}
  * 样例：svr_ip=xxx.xxx.xxx.xxx 服务器磁盘只读
* 告警详情
  * 模板：\${alarm_target} ${alarm_name}
  * 样例：服务器：xxx.xxx.xxx.xxx ，告警：磁盘挂载点 /data/t 只读

## 对系统的影响

该告警项默认实现对挂载点 `/` 只读的检查。当 `/` 挂载点只读时，大部分进程将无法工作，如写日志、更新配置都无法正常工作，系统将出现严重问题。

## 可能原因

* 以只读模式挂载。
* 文件系统错误。
* 磁盘产生坏道。

## 处理方法

1. 执行如下命令验证告警是否属实。
   1. 执行 `$mount | grep '(ro,'` 命令查看只读挂载点。
   2. 执行 `df -h` 查看该磁盘挂载点是否挂载的根目录。
2. 联系厂家修复，或更换磁盘。
