base_backup_too_long_time_no_one_success_task 长时间无成功备份
===========================================================================



告警描述
-------------------------

该告警监测 OceanBase 集群是否长时间没有成功的数据备份，没有则上报告警。

告警原理
-------------------------

OCP-Server 设置了每分钟的定时检查任务，当长时间没有成功的数据备份则会触发告警，包含逻辑备份和物理备份。也可以理解为上一次成功的数据备份任务是在 n 天前，当 n 大于阈值时上报告警。
**说明**



告警阈值由 `ocp.backup.alarm.base-backup-last-finished-threshold` 参数控制，默认为 9 天。也可在备份策略的 **报警阈值配置** 中通过 **无成功数据备份的报警天数** 来配置告警阈值。

规则信息
-------------------------



| 监控指标 | 默认阈值 | 持续时间 | 检测周期 | 消除周期 |
|------|------|------|------|------|
| NA   | 9    | 0 秒  | 60 秒 | 5 分钟 |



告警信息
-------------------------



|  告警触发方式  | 告警等级 | 范围 |
|----------|------|----|
| OCP 操作提醒 | 严重   | 服务 |



告警模板
-------------------------

* 概述模板: ${alarm_target} ${alarm_name}



* 详情模板: ${alarm_description}



* 概述样例: ob_cluster=C1-1000 数据备份较长时间没有成功的备份告警



* 详情样例: obCluster: C1-1000, no successful data backup in 9 days, last successful time: 2020-01-05 02:00:00, current time: 2020-01-15 01:00:00, service ip: 127.0.0.1, error message:






对系统的影响
---------------------------

导致数据恢复缓慢，也可能影响数据的可恢复性。

可能原因
-------------------------

* 最近手动备份的任务失败。



* 定时调度的备份任务失败。






处理方法
-------------------------

* 备份任务失败。

  查看备份任务的错误信息，必要情况下进一步查看日志明确错误原因。
  1. 登录 OCP 云平台，在 **集群概览** 页面的 **集群列表** 中单击要查看的集群名称。



  2. 在左侧导航栏中单击 **备份恢复** 。



  3. 查看最近的数据备份任务是否失败。

     * 如果失败，可以在任务右侧点击查看原因。



     * 如果最近无数据备份任务，需要按照可能原因为备份调度任务失败来处理。









* 备份调度任务失败：

  1. 登录 OCP 云平台，在 **集群概览** 页面的 **集群列表** 中单击要查看的集群名称。



  2. 在左侧导航栏中单击 **备份恢复** 。



  3. 查看备份恢复菜单对应的页面，单击备份调度历史后的 **查看** 按钮，查看最近的调度任务有无失败，可以查看任务日志确认原因。
