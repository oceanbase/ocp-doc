任务管理
=========================

本节介绍如何查看任务详情、如何处理失败的任务。

前提条件
-------------------------

登录用户拥有系统管理员（ADMIN）或任务管理（TASK_MANAGER）角色。

查看任务详情
---------------------------

1. 登录 OCP。



2. 在左侧导航栏中单击 **系统管理** **\>** **任务** 。



3. 在 **任务列表** 的右上角选择任务的状态，输入集群名，并单击搜索按钮。![07021600](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3216555261/p291067.png) **任务列表** 中将返回所有符合条件的任务。



4. 单击要查看的任务名，进入该任务的详细界面。

   任务详情页中默认以日志视图展示，可通过如图中 1 处的按钮切换成流转视图。

   日志视图下，提供对进展的多个任务日志的展示，可通过图中区域 2 进行切换。当 `Prepare upgrade cluster` 步骤失败后有重试或回滚的操作，则区域 2 中会显示三个按钮分别针对首次执行、回滚和重试，单击对应按钮则会切换到相应的操作日志。![07021544](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3216555261/p291059.png)
   

5. 任务详情页中，以流转视图为例，单击指定步骤右侧的 **...** 中的操作项即可操作当前步骤。步骤的状态不同所支持的操作也不同，具体以 **...** 中显示的为准。日志视图下也支持此操作。

   **说明**



   任务详情页中 **流转视图** 通过拓扑图展示各个步骤的上下游关系。通过鼠标在空白处拖拽可以移动拓扑图，通过鼠标滚轮滑动可以进行缩放，也可以通过右上方的缩放控件调整画布大小。拓扑图缩放是以鼠标指针为中心进行的，对于任务流程比较长的情况，可以先缩小，快速定位到关心的步骤，再进行放大，达到快速定位的目的。
   * 成功状态的节点可执行查询日志操作。

     展开折叠菜单后，在屏幕的下方会出现折叠窗口展示日志信息，窗口可以拖动进行放大。


   * 失败状态的节点可执行如下操作。

     * 查看日志信息。



     * 重新运行：重新运行当前节点，即先回滚再执行，成功执行的话继续执行下游节点。



     * 设置为成功：将当前节点的状态直接设置为成功状态，继续执行下游节点。






   * 运行状态的节点可查看日志或者终止运行，终止运行后该节点会变为失败状态。



   * 等待运行的节点不可进行任何操作。






   ![image.png](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1448190061/p168505.png "image.png")






重试/放弃失败任务
------------------------------

1. 登录 OCP。



2. 在左侧导航栏中单击 **系统管理** **\>** **任务** 。



3. 在 **任务列表** 的右上角选择任务的状态，输入集群名，并单击搜索按钮。



4. 单击要查看的任务名，进入该任务的详细界面。



5. 在任务详情页面的右上角单击 **放弃任务** 或 **重试** 。![05101010](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6761460261/p272014.png)

   * 放弃任务：从失败处向任务的根结点，执行每一个步骤的回滚操作，主要用于任务的资源回收、状态修改等目的。



   * 重试：回滚当前步骤所有失败节点并再次执行，如果执行成功则继续执行后续步骤。
