ob_host_net_recv_percent_over_threshold OB 服务器网络接收带宽使用率超限
==============================================================================

**告警描述**
-----------------------------

OBServer 所在服务器的网络带宽在接收上的使用率超过阈值。

告警原理
-------------------------

下表列出了该告警监控逻辑中涉及的关键参数。

|  参数   |                                                                                                                                                     值                                                                                                                                                     |
|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 监控指标  | ob_host_net_send_percent                                                                                                                                                                                                                                                                                  |
| 指标来源  | <li> bandwidth：网络带宽，通过 python 脚本中的 psutil.net_if_stats() 函数采集得到，采集数据会被转化为以 byte 为单位（即结果\*1024\*1024）。  <li>  </li> node_network_receive_bytes_total：网络收到的数据总量，通过 node_exporter 进程采集得到，可访问本机的 http://localhost:63000/metrics 查看。 </li>   |
| 采集指标  | node_network_receive_bytes_total、bandwidth                                                                                                                                                                                                                                                                |
| 监控表达式 | 100 * max(sum(rate(node_network_receive_bytes_total{@LABELS}[@INTERVAL\]) by (device,@GBLABELS)) by (device,@GBLABELS) / sum(bandwidth{@LABELS}) by (device,@GBLABELS)) by (@GBLABELS)                                                                                                                  |
| 采集周期  | 1 秒                                                                                                                                                                                                                                                                                                       |

<main id="notice" type='explain'>
    <h4>说明</h4>
    <p>该告警的指标来源相对特殊，由 OCP-Agent 监控本机网络使用量，但数据采集是由 python 脚本和 exporter 进程进行，具体可参考表中 <b>指标来源</b> 的说明。</p>
 </main>

**监控指标** ob_host_net_send_percent 的值表示 OBServer 网络接收占用带宽率，当该值大于阈值（默认为 80%）时触发告警。

**规则信息**
-----------------------------

|           监控指标           | 默认阈值（单位：%） | 持续时间  | 检测周期 | 消除周期 |
|--------------------------|------------|-------|------|------|
| ob_host_net_send_percent | 80         | 120 秒 | 60 秒 | 5 分钟 |

**告警信息**
-----------------------------

|   告警触发方式   | 告警等级 | 范围  |
|------------|------|-----|
| 基于监控指标的表达式 | 严重   | 服务器 |

**告警模板**
-----------------------------

* 告警概述模板：\${alarm_target} ${alarm_name}

* 告警详情模板：\${alarm_target} \${alarm_name}接收宽带使用率\${value} 超过 ${alarm_threshold}

* 告警概述样例：ob_cluster=C1-1000:svr_ip=xxx.xxx.xxx.xxx OB 服务器网络接收带宽使用率超限

* 告警详情样例：ob_cluster=C1-1000:svr_ip=xxx.xxx.xxx.xxx OB 服务器网络接收带宽使用率超限 接收带宽使用率 81.0 超过 80.0

**对系统的影响**
-------------------------------

网络带宽即将用尽时，OceanBase 的性能将遇瓶颈，当业务用量持续增大时，OceanBase 性能将无法满足业务需求。

**可能原因**
-----------------------------

常见于 OceanBase 数据库业务量增大，如 SQL 请求频繁。

解决方法
-------------------------

进入 OCP 上告警主机的 **监控** 界面，查看 **主机性能** 页签中的 **网络吞吐率** 。

观察告警时刻的网络吞吐率。![08061601](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9177829261/p302075.png)

* 若异常飙高，则可能是短期业务量大。

  可等业务量回到正常状态持续 5 分钟后，观察告警是否自动消除。
  
* 若网络吞吐率曲线是逐步上升的，或飙高后持续不下降的，则是正常业务扩张需要。

  请联系网络工程师，增大该主机的网络带宽。
