# 磁盘及目录规划

本机为您介绍部署社区版 OCP 所需的磁盘规划和目录规划。

## DB 磁盘规划

### MetaDB

磁盘容量受 OCP 管控的集群规模、存储的文件资源和数据保留时间等因素的影响，一般推荐磁盘有 100 GB 以上。当发现磁盘资源不够时，可以按照需要进行扩容操作。

### MonitorDB

如果管理的 OBServer 节点数量在 10 台以内，且业务量不大，推荐按照最小 150GB 的磁盘进行规划。若业务量较大，则可参考下述方法估算 MonitorDB 所需的磁盘量。

* 估算说明：监控数据主要分为指标数据和 SQL 执行记录两部分。

  * 指标数据，存储消耗大约为每 Server 每天增量 100MB\~300MB。

  * SQL 执行记录，存储消耗与业务用量有关，经验值是数据规模大约为 指标数据的 10 倍\~50 倍。

  按照经验值估算，平均每 Server 一天的监控数据增量为 1G\~40GB，按照 20G 预估。OCP 使用分区表保存监控数据，监控数据的保留周期如下：
  * 指标数据：秒级保留 8 天，分钟级保留 31 天。

  * SQL 执行记录：保留 8 天。

由于大部分存储空间由 SQL 执行记录占用，估算磁盘资源使用时基于SQL 执行记录进行估算。

* 资源估算公式：待管理的所有 OB 集群机器数量。下述以 server_count 为例：

  * OCP 监控数据库每天的数据增量预估为 server_count \*20G。

  * MonitorDB 存储需求为每天的数据增量 \* 8 天。

* 估算样例：待管理的所有 OB 集群机器数量。下述以 20 为例：

  * OCP 监控数据库每天的数据增量预估为 20\*20 G = 400GB。

  * MonitorDB 存储容量预估为 400 GB/天\*8天=3200GB，约 3.2 TB。

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>前面给出的资源消耗只是一个粗略的预估，实际的 MonitorDB 资源消耗根据业务用量会有差异。</p>
  </main>

根据上述描述，下述表格为您提供了最小容量参考，您需按照如下表格准备好相应大小的目录。

|          目录          |  容量  |                             说明                             |
|----------------------|------|------------------------------------------------------------|
| /home/admin/observer | 20G  | OceanBase 安装目录。 需手工创建并保证 admin 用户对该目录可读可写。 |
| /data/               | 250G | 用于存放 OCP 的业务。 需手工创建并保证 admin 用户对该目录可读可写。   |

## OCP 磁盘规划

OCP 以 Docker 形式部署，OCP-Server 在运行过程中会写入文件到磁盘，这些数据会占用磁盘空间，我们推荐至少需要预留 350 GB 的空间给 OCP-Server Docker 使用，以免因磁盘写满导致功能受影响。

OCP-Server 在运行过程中的磁盘使用情况如下表所示。

|   **类别**   |                                                                 **存储路径**                                                                  |                                                  **容量要求**                                                   |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
| OCP 程序     | */home/admin/ocp-server/* /home/admin/ocp-init/    | OCP 程序安装后大约占用 1 GB 空间，自带 rpm 约占用 5 GB，建议预留 10 GB。                                                           |
| OCP 主进程日志  | /home/admin/logs/ocp/                                                                                                                     | OCP 系统参数配置了 log 文件大小和保留的文件数量。 默认配置为单个文件 100 MB，每天至少 5-10 个文件，每个文件最多保留 100 天，建议预留 100 GB 空间。 |
| OCP 任务日志   | /home/admin/logs/task/                                                                                                                    | 未设置容量限制，OCP 会定时清理任务日志，清理任务按照磁盘剩余空间大于 20 % 的目标清理日志文件。清理时，首先清理更新时间更早的日志文件，需预留 100 GB 空间。                      |
| OCP 文件本地缓存 | /home/admin/data/files/                                                                                                                   | 未设置容量限制，OCP 文件主要是 OCP 管理对象相关的安装包，且主要是 OceanBase 安装包，安装包大小平均在 500 MB 左右，按照 100 个安装包预估，需预留 100 GB 空间。         |
